<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Publications | Portfolio Varun</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../projects/style.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <style>
    /* Basic styling for the layout and project-card */

    body {
      margin: 0; 
      padding: 0;
      font-family: 'Poppins', sans-serif;
      background: #f0f0f0;
    }
    header {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 2rem 5%;
      height: 7rem;
      background-color: #fff;
      box-shadow: 0 1px 4px rgba(146,161,176,0.3);
      transition: background-color 0.3s ease;
    }
    header .logo {
      font-size: 2rem;
      font-weight: 800;
      color: #1a1a1a;
      display: flex; align-items: center;
    }
    header .logo i {
      font-size: 2.4rem;
      margin-right: 0.5rem;
    }
    header .navbar ul {
      list-style: none;
      display: flex; align-items: center;
    }
    header .navbar li { margin-left: 3rem; }
    header .navbar ul li a {
      font-size: 1.6rem;
      color: #1a1a1a;
      font-weight: 600;
      letter-spacing: 0.05rem;
      padding: 0.6rem 0;
      text-decoration: none;
    }
    header .navbar ul li a.active,
    header .navbar ul li a:hover {
      color: #5115f2;
      border-bottom: 2px solid #5115f2;
    }
    .work {
      background: linear-gradient(to bottom, #2b2d7f, #110d39);
      margin-top: 6rem;
      padding: 5rem 0;
    }
    .work h2 {
      color: #fff;
      text-align: center;
      font-size: 3.5rem;
      margin-bottom: 2rem;
    }
    .projects-container {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      padding: 2rem;
    }
    .project-card {
      background: #ffffff;
      border-radius: 15px;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
      padding: 30px;
      transition: transform 0.3s ease-in-out, box-shadow 0.3s ease;
      overflow: hidden;
    }
    .project-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }
    .project-card h3 {
      font-size: 2.2rem;
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
      transition: color 0.3s ease;
    }
    .project-card h3:hover {
      color: #0073e6;
    }
    .project-card p {
      font-size: 1.4rem;
      line-height: 1.7;
      margin-bottom: 20px;
      color: #666;
    }
    /* Captions or links to the actual publication. */
    .publication-link a {
      display: inline-block;
      margin-top: 10px;
      padding: 0.5rem 1rem;
      background: #0073e6;
      color: #fff;
      border-radius: 5px;
      text-decoration: none;
      font-size: 1.4rem;
    }
    .publication-link a:hover {
      background: #005bb5;
    }

    /* Radio-based Carousel (3-slot) with images or videos + captions */
    input[type="radio"] {
      display: none;
    }
    .cards {
      position: relative;
      width: 100%;
      margin-top: 1.5rem;
      height: 360px; /* or whatever you want */
    }
    .card-label {
      position: absolute;
      width: 60%;
      height: 100%;
      left: 0; right: 0;
      margin: auto;
      transition: transform 0.4s ease, opacity 0.4s ease;
      cursor: pointer;
      border-radius: 10px;
      overflow: hidden;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      opacity: 0; /* hidden by default */
      z-index: 0;
    }
    .media-wrapper {
      flex: 1;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .media-wrapper img,
    .media-wrapper video {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border: none;
    }
    .media-caption {
      width: 100%;
      background: #333;
      color: #fff;
      font-size: 1.2rem;
      text-align: center;
      padding: 0.5rem;
      box-sizing: border-box;
    }
    .card-label:hover {
      box-shadow: 0 0 10px #7f0;
    }

    /* The modal for zooming in on center card */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal-content {
      position: relative;
      max-width: 90%;
      max-height: 90%;
      background: #000;
      border-radius: 10px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content img,
    .modal-content video {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    .modal-close {
      position: absolute;
      top: 10px; right: 10px;
      color: #fff;
      background: rgba(255,255,255,0.2);
      border: none;
      font-size: 1.8rem;
      width: 40px; height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
    }
    .modal-close:hover {
      background: rgba(255,255,255,0.4);
    }

    /* We'll store dynamic transform rules here */
  </style>
  <style id="dynamicCarouselStyles"></style>
</head>
<body oncontextmenu="return false">
<header>
  <a href="/portfolio/" class="logo"><i class="fab fa-node-js"></i> Varun</a>
  <div id="menu" class="fas fa-bars"></div>
  <nav class="navbar">
    <ul>
      <li><a href="/portfolio/#home">Home</a></li>
      <li><a href="/portfolio/#about">About</a></li>
      <li><a href="/portfolio/#skills">Skills</a></li>
      <li><a href="/portfolio/#education">Education</a></li>
      <li><a href="/portfolio/#projects">Work</a></li>
      <li><a href="/portfolio/#experience">Experience</a></li>
      <li><a class="active" href="/portfolio/#publications">Publications</a></li>
      <li><a href="/portfolio/#contact">Contact</a></li>
    </ul>
  </nav>
</header>

<section class="work" id="publications">
  <h2 class="heading"><i class="fas fa-laptop-code"></i> Publications</h2>
  <div class="projects-container" id="publicationsContainer"></div>
</section>

<div class="backbtn" style="text-align: center; margin-bottom: 2rem;">
  <a href="/portfolio/" class="btn" style="display:inline-block; padding: 1rem 2rem; background:#333; color: #fff; border-radius:5px; text-decoration: none;">
    <i class="fas fa-arrow-left"></i>
    <span>Back to Home</span>
  </a>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal-content" id="modalContent">
    <button class="modal-close" id="modalClose">&times;</button>
  </div>
</div>

<script>
  const modalOverlay = document.getElementById('modalOverlay');
  const modalContent = document.getElementById('modalContent');
  const modalClose = document.getElementById('modalClose');

  async function loadPublications() {
    try {
      const response = await fetch('publications.json');
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      const data = await response.json();
      const container = document.getElementById('publicationsContainer');
      const styleEl = document.getElementById('dynamicCarouselStyles');
      let styleRules = "";

      data.publications.forEach((pub, pIndex) => {
        // Build the publication card
        let pubDiv = document.createElement('div');
        pubDiv.classList.add('project-card');

        // Basic info
        let linkHTML = pub.link
          ? `<div class="publication-link"><a href="${pub.link}" target="_blank"><i class="fas fa-arrow-right"></i> Publication</a></div>`
          : "";

        pubDiv.innerHTML = `
          <h3>${pub.title}</h3>
          <p>${pub.overview}</p>
          ${linkHTML}
        `;

        // Gather images or videos if you have them
        // If your publications also have a "visuals" array, do so. Otherwise adapt as needed.
        // e.g. data structure: { "publications": [{... "visuals": {"images": [...], "videos": [...]}}] }
        let mediaItems = [];
        if (pub.visuals?.videos) {
          pub.visuals.videos.forEach(v => mediaItems.push({ type:'video', src:v.src, caption:v.caption || "" }));
        }
        if (pub.visuals?.images) {
          pub.visuals.images.forEach(i => mediaItems.push({ type:'image', src:i.src, caption:i.caption || "" }));
        }

        if (mediaItems.length > 0) {
          // Build radio + cards
          let radioName = `pubslider-${pIndex}`;
          let radioHTML = "";
          let cardsHTML = `<div class="cards">`;

          mediaItems.forEach((m, i) => {
            let slotID = `pubslot${i}-p${pIndex}`;
            radioHTML += `<input type="radio" name="${radioName}" id="${slotID}" ${i===0?'checked':''} />`;
          });

          mediaItems.forEach((m, i) => {
            let cardID = `pubmedia${i}-p${pIndex}`;
            let slotID = `pubslot${i}-p${pIndex}`;
            let content = `
              <div class="media-wrapper">
                ${
                  m.type==='image'
                  ? `<img src="${m.src}" alt="Pub Media ${i}" />`
                  : `<video controls><source src="${m.src}" type="video/mp4"></video>`
                }
              </div>
              ${m.caption ? `<div class="media-caption">${m.caption}</div>` : ""}
            `;
            cardsHTML += `
              <label class="card-label" id="${cardID}" for="${slotID}"
                data-media-type="${m.type}" data-media-src="${m.src}">
                ${content}
              </label>
            `;
          });

          cardsHTML += "</div>";
          pubDiv.innerHTML += radioHTML + cardsHTML;

          // offset=0 => center, ±1 => side, else hidden
          styleRules += buildOffsetRules(pIndex, mediaItems.length);
        }

        container.appendChild(pubDiv);
      });

      styleEl.innerHTML = styleRules;
      attachModalEvents();

    } catch (error) {
      console.error("Error loading publications:", error);
    }
  }

  function buildOffsetRules(pIndex, N) {
    let out = "";
    for (let i=0; i<N; i++) {
      let slotID = `pubslot${i}-p${pIndex}`;
      for (let j=0; j<N; j++) {
        let cardID = `pubmedia${j}-p${pIndex}`;
        let offset = j - i;
        while (offset > N/2) offset -= N;
        while (offset <= -N/2) offset += N;

        let transform = "translateX(200%) scale(0.6)";
        let op = "0";
        let z = "0";

        if (offset === 0) {
          transform = "translateX(0) scale(1)";
          op = "1"; z="2";
        } else if (offset === 1 || offset === -(N-1)) {
          transform = "translateX(40%) scale(0.8)";
          op = "0.4"; z="1";
        } else if (offset === -1 || offset === (N-1)) {
          transform = "translateX(-40%) scale(0.8)";
          op = "0.4"; z="1";
        }
        out += `
          #${slotID}:checked ~ .cards #${cardID} {
            transform: ${transform};
            opacity: ${op};
            z-index: ${z};
          }
        `;
      }
    }
    return out;
  }

  function attachModalEvents() {
    const allCards = document.querySelectorAll('.card-label');
    allCards.forEach(card => {
      card.addEventListener('click', e => {
        const radioId = card.getAttribute('for');
        const radio = document.getElementById(radioId);
        // If it’s already checked => center => open modal
        if (radio && radio.checked) {
          e.preventDefault();
          const type = card.getAttribute('data-media-type');
          const src = card.getAttribute('data-media-src');
          openModal(type, src);
        }
      });
    });

    modalClose.addEventListener('click', closeModal);
    modalOverlay.addEventListener('click', e => {
      if (e.target.id==='modalOverlay') closeModal();
    });
  }

  function openModal(type, src) {
    while (modalContent.firstChild && !modalContent.firstChild.classList?.contains('modal-close')) {
      modalContent.removeChild(modalContent.firstChild);
    }
    let el;
    if (type==='image') {
      el = document.createElement('img');
      el.src = src;
      el.style.maxWidth = '100%';
      el.style.maxHeight = '100%';
    } else {
      el = document.createElement('video');
      el.controls = true;
      el.style.maxWidth = '100%';
      el.style.maxHeight = '100%';
      let source = document.createElement('source');
      source.src= src; source.type='video/mp4';
      el.appendChild(source);
    }
    modalContent.insertBefore(el, modalClose);
    modalOverlay.classList.add('active');
  }

  function closeModal() {
    modalOverlay.classList.remove('active');
  }

  document.addEventListener("DOMContentLoaded", loadPublications);
</script>
</body>
</html>
